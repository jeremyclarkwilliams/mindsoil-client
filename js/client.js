$(document).ready(function(){$("#file-upload").fileupload({dataType:"json",maxFileSize:1e8,maxChunkSize:1e6})});var ClientBox=React.createClass({displayName:"ClientBox",getInitialState:function e(){return{directoryList:!0,directoryAdd:!1,fileAdd:!1,folderAdd:!1,preview:!1,previewType:"",previewPath:"",previewExt:"",buttonAdd:!0}},toggleAdd:function t(){this.setState({directoryList:!this.state.directoryList,directoryAdd:!this.state.directoryAdd,preview:!1})},hideAdd:function a(){this.setState({directoryList:!0,directoryAdd:!1,fileAdd:!1,folderAdd:!1,preview:!1,buttonAdd:!0})},backToAdd:function i(){this.setState({directoryAdd:!0,fileAdd:!1,folderAdd:!1})},toggleFileAdd:function d(){this.setState({fileAdd:!this.state.fileAdd,directoryAdd:!this.state.directoryAdd})},toggleFolderAdd:function s(){this.setState({folderAdd:!this.state.folderAdd,directoryAdd:!this.state.directoryAdd}),setTimeout(function(){$("#add-folder").focus()},500)},togglePreview:function l(e,t,a){this.setState({directoryList:!this.state.directoryList,preview:!0,previewType:e,previewPath:t,previewExt:a,buttonAdd:!1})},clearChecks:function r(){this.refs.foldersfiles.clearCheacks()},loadFoldersFiles:function c(){this.refs.foldersfiles.loadFoldersFiles()},loadBreadcrumbs:function n(){this.refs.breadcrumbs.loadBreadcrumbs()},render:function o(){return React.createElement("div",{className:"container"},React.createElement(Breadcrumbs,{hideAdd:this.hideAdd,loadFoldersFiles:this.loadFoldersFiles,ref:"breadcrumbs"}),React.createElement(FoldersFiles,{active:this.state.directoryList,preview:this.state.preview,toggleAdd:this.toggleAdd,togglePreview:this.togglePreview,loadBreadcrumbs:this.loadBreadcrumbs,ref:"foldersfiles"}),React.createElement(AddButtons,{active:this.state.directoryAdd,toggleFileAdd:this.toggleFileAdd,toggleFolderAdd:this.toggleFolderAdd}),React.createElement(FileAdd,{active:this.state.fileAdd,hideAdd:this.hideAdd,loadBreadcrumbs:this.loadBreadcrumbs,loadFoldersFiles:this.loadFoldersFiles}),React.createElement(FolderAdd,{active:this.state.folderAdd,hideAdd:this.hideAdd,loadBreadcrumbs:this.loadBreadcrumbs,loadFoldersFiles:this.loadFoldersFiles}),React.createElement(Preview,{active:this.state.preview,type:this.state.previewType,path:this.state.previewPath,ext:this.state.previewExt}),React.createElement("button",{className:this.state.directoryAdd||this.state.fileAdd||this.state.folderAdd?this.state.buttonAdd?"btn-add close":"btn-add close hide":this.state.buttonAdd?"btn-add":"btn-add hide",id:"btn-add",title:"Add file or folder",onClick:this.state.fileAdd||this.state.folderAdd?this.backToAdd:this.toggleAdd}))}}),Breadcrumbs=React.createClass({displayName:"Breadcrumbs",loadBreadcrumbs:function h(){$.ajax({type:"POST",url:"get-breadcrumbs.php",dataType:"json",cache:!1,success:function(e){this.setState({paths:e})}.bind(this),error:function(e,t,a){console.error("get-breadcrumbs.php",t,a.toString())}.bind(this)}).done(function(){this.setState({hdrWidth:$("#breadcrumbs").width()}),this.setState({crumbWidth:this.crumbsWidth()}),this.truncate()}.bind(this))},getInitialState:function p(){return{paths:[],hdrWidth:0,crumbWidth:0}},componentDidMount:function u(){$(window).on("resize",this.handleResize),this.loadBreadcrumbs()},componentWillUnmount:function f(){$(window).off("resize")},handleClick:function m(e){$.ajax({url:"change-path.php",type:"POST",data:{path:e},success:function(e){e&&(this.loadBreadcrumbs(),this.props.loadFoldersFiles(),this.props.hideAdd())}.bind(this)})},handleResize:function b(e){prevHdrWidth=this.state.hdrWidth,this.setState({hdrWidth:$("#breadcrumbs").width()}),(prevHdrWidth<this.state.hdrWidth&&prevHdrWidth>=991&&this.state.hdrWidth<=991||prevHdrWidth>this.state.hdrWidth&&prevHdrWidth<=991&&this.state.hdrWidth>=991)&&this.setState({crumbWidth:this.crumbsWidth()}),this.truncate()},crumbsWidth:function v(){for(var e=0,t=$("#breadcrumbs .crumb"),a=0;a<t.length;a++)e+=t.eq(a).width();return e},truncate:function y(){this.state.crumbWidth>this.state.hdrWidth&&!$("#breadcrumbs .crumb").last().prev().hasClass("trunc")?($("#breadcrumbs .crumb").not(".trunc, :last-child").eq(1).addClass("trunc"),$("#breadcrumbs .trunc").length>1&&$("#breadcrumbs .trunc").eq(0).hide()):this.state.crumbWidth<this.state.hdrWidth&&$("#breadcrumbs .trunc").length>0&&$("#breadcrumbs .trunc").show().removeClass("trunc")},render:function g(){var e="";return React.createElement("ol",{className:"hdr",id:"breadcrumbs"},this.state.paths.map(function(t,a){return e+=1>=a?t:"/"+t,1==this.state.paths.length?React.createElement("li",{className:"crumb",key:a},"All Files"):0==a?React.createElement("li",{className:"crumb",key:a},React.createElement("button",{className:"btn-crumb",onClick:this.handleClick.bind(this,e)},"All Files")):a==this.state.paths.length-1?React.createElement("li",{className:"crumb",key:a},t):React.createElement("li",{className:"crumb",key:a},React.createElement("button",{className:"btn-crumb",onClick:this.handleClick.bind(this,e)},t))}.bind(this)))}}),Checkbox=React.createClass({displayName:"Checkbox",render:function w(){return React.createElement("button",{className:this.props.active?"checkbox checked":"checkbox",onClick:this.props.handleCheckbox})}}),FoldersFiles=React.createClass({displayName:"FoldersFiles",loadFoldersFiles:function F(){$.ajax({type:"POST",url:"get-folders-files.php",dataType:"json",cache:!1,success:function(e){this.setState({folders:e.folders,files:e.files,types:e.type,folderpaths:e.folderpath,filepaths:e.filepath,exts:e.ext,preview:e.preview}),0==this.state.folders.length&&0==this.state.files.length&&this.props.active&&!this.state.preview?this.props.toggleAdd():this.state.preview&&this.props.togglePreview(this.state.types[0],this.state.filepaths[0],this.state.exts[0])}.bind(this),error:function(e,t,a){console.error("get-folders-files.php",t,a.toString())}.bind(this)})},getInitialState:function A(){return{client:window.location.pathname.split("/").pop(),folders:[],files:[],types:[],folderpaths:[],filepaths:[],exts:[],preview:this.props.preview,selectedFiles:[],checked:[]}},componentDidMount:function R(){this.loadFoldersFiles()},handleClick:function k(e,t,a){$.ajax({url:"change-path.php",type:"POST",data:{path:e},success:function(e){e&&(this.clearChecks(),this.loadFoldersFiles(),this.props.loadBreadcrumbs())}.bind(this)}).done(function(){$(".btn-file").blur()})},handleCheckbox:function C(e,t){var a=this.state.selectedFiles,i=this.state.checked;if(i[t]){var d=a.indexOf(e);a.splice(d,1)}else a.push(e);i[t]=!i[t],this.setState({selectedFiles:a,checked:i})},clearChecks:function E(){this.setState({selectedFiles:[],checked:[]})},triggerDownload:function N(){null!==this.download&&(this.download.click(),$(".btn-file").blur())},downloadButton:function x(e,t){var a=this;return"doc"==e?React.createElement("span",{className:"btn btn-download"},"Download",React.createElement("a",{href:t,download:!0,ref:function(e){return a.download=e}})):void 0},downloadMultiple:function S(){$.ajax({url:"zip-files.php",type:"POST",data:{files:this.state.selectedFiles},success:function(e){e&&(this.downloadZip.click(),this.clearChecks(),this.loadFoldersFiles())}.bind(this)}).done(function(){$(".btn-download").blur()})},render:function B(){var e=this;return React.createElement("ul",{className:this.props.active?"directory-list active":"directory-list",id:"directory-list"},this.state.folders.map(function(e,t){return path=this.state.folderpaths[t],React.createElement("li",{className:"directory-item folder",key:t},React.createElement("button",{className:"btn-file","data-path":path,onClick:this.handleClick.bind(this,path)},e))}.bind(this)),this.state.files.map(function(e,t){return type=this.state.types[t],path=this.state.filepaths[t],downloadPath=this.state.client+path,ext=this.state.exts[t],checked=this.state.checked[t],React.createElement("li",{className:"directory-item file "+type,key:t},React.createElement("button",{className:"btn-file",onClick:"doc"==type?this.triggerDownload:this.handleClick.bind(this,path)},e,this.downloadButton(type,downloadPath)),React.createElement(Checkbox,{path:path,handleCheckbox:this.handleCheckbox.bind(this,path,t),active:checked,index:t}))}.bind(this)),React.createElement("li",{className:this.state.checked.length>0?"directory-item download active":"directory-item download"},React.createElement("button",{className:"btn btn-download",onClick:this.downloadMultiple},"Download Selected"),React.createElement("a",{href:this.state.client+"/files.zip","class":"download-zip",download:!0,ref:function(t){return e.downloadZip=t}})))}}),AddButtons=React.createClass({displayName:"AddButtons",render:function W(){return React.createElement("div",{className:this.props.active?"directory-add active":"directory-add",id:"directory-add"},React.createElement("button",{className:"btn-upload",id:"btn-add-file",onClick:this.props.toggleFileAdd},"Upload File"),React.createElement("button",{className:"btn-upload",id:"btn-add-folder",onClick:this.props.toggleFolderAdd},"Create Folder"))}}),FileAdd=React.createClass({displayName:"FileAdd",triggerUpload:function P(){$("#file-upload").trigger("click").fileupload({add:function e(t,a){a.submit()},progressall:function t(e,a){var i=parseInt(a.loaded/a.total*100,10);i+=5,$("#add-file").css({background:"linear-gradient(45deg, #666666 "+i+"%, #ffffff "+i+"%)"})},done:function(e,t){$("#add-file").css({background:"rgba(255,255,255,0.7)"}),this.props.hideAdd(),this.props.loadFoldersFiles()}.bind(this)})},render:function T(){return React.createElement("div",{className:this.props.active?"directory-add file-add active":"directory-add file-add",id:"file-add"},React.createElement("form",{className:"form"},React.createElement("input",{id:"file-upload",className:"input input-hide",type:"file",name:"files[]","data-url":"upload-file.php",multiple:!0}),React.createElement("label",{"for":"add-file",className:"label no-label label-file"},"Select File"),React.createElement("input",{id:"add-file",type:"text",className:"input input-icon input-file",placeholder:"Select File",onClick:this.triggerUpload})))}}),FolderAdd=React.createClass({displayName:"FolderAdd",getInitialState:function j(){return{folder:""}},handleFolderChange:function D(e){this.setState({folder:e.target.value})},handleValidity:function z(e,t){t=t.trim();var a=!t||/[^\w\-]+/gi.test(t);this.checkFolderName(t).done(function(t){a=a||t,a?$("[for=add-"+e+"]").addClass("invalid").removeClass("valid"):$("[for=add-"+e+"]").addClass("valid").removeClass("invalid"),$("#folder-add .label.valid").length===$("#folder-add .label").length?$("#btn-create-folder").prop("disabled",!1):$("#btn-create-folder").prop("disabled",!0)})},checkFolderName:function I(e){return $.ajax({url:"check-folder.php",type:"POST",data:{folder:e}})},handleSubmit:function O(e){e.preventDefault();var t=this.state.folder.trim();$.ajax({url:"create-folder.php",type:"POST",data:{folder:t},success:function(e){e&&(this.props.hideAdd(),this.props.loadBreadcrumbs(),this.props.loadFoldersFiles())}.bind(this)})},render:function L(){return React.createElement("div",{className:this.props.active?"directory-add folder-add active":"directory-add folder-add",id:"folder-add"},React.createElement("form",{className:"form",onSubmit:this.handleSubmit,novalidate:!0},React.createElement("label",{htmlFor:"add-folder",className:"label no-label label-folder"},"Folder Name"),React.createElement("input",{type:"text",id:"add-folder",className:"input input-icon",name:"folder",placeholder:"Folder Name",value:this.state.folder,onChange:this.handleFolderChange,onKeyUp:this.handleValidity.bind(this,"folder",this.state.folder)}),React.createElement("input",{type:"submit",name:"submit",id:"btn-create-folder",className:"btn-upload",value:"Create Folder",disabled:!0})))}}),Preview=React.createClass({displayName:"Preview",getInitialState:function M(){return{type:"",path:"",ext:""}},setValues:function H(){this.setState({type:this.props.type,path:this.props.path,ext:this.props.ext})},componentDidMount:function U(){setInterval(this.setValues,this.props.pollInterval)},render:function V(){return React.createElement("div",{className:this.props.active?"file-preview active":"file-preview",id:"file-preview"},"image"==this.state.type?React.createElement("img",{src:this.state.path,className:"img-preview"}):null,"video"==this.state.type?React.createElement("video",{className:"video-preview",controls:!0},React.createElement("source",{src:this.state.path,type:"video/"+this.state.ext})):null,"pdf"==this.state.type?React.createElement("iframe",{src:this.state.path,className:"pdf-preview"}):null,React.createElement("a",{href:this.state.path,className:"btn btn-download",download:!0},"Download"))}});ReactDOM.render(React.createElement(ClientBox,null),document.getElementById("client-panel"));